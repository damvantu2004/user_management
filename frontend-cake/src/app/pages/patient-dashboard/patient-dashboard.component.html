<div class="d-flex">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Main Content -->
  <div class="main-content flex-grow-1">
    <div class="container-fluid py-4">
      <!-- Header Welcome -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-0 bg-primary text-white">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-8">
                  <h3 class="mb-1">Xin ch√†o, {{ currentUser?.name }}! üëã</h3>
                  <p class="mb-0 opacity-75">Ch√†o m·ª´ng b·∫°n ƒë·∫øn v·ªõi h·ªá th·ªëng ƒë·∫∑t l·ªãch kh√°m b·ªánh</p>
                </div>
                <div class="col-md-4 text-end">
                  <i class="fas fa-user-injured fa-3x opacity-50"></i>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <div class="text-primary mb-2">
                <i class="fas fa-calendar-alt fa-2x"></i>
              </div>
              <h4 class="fw-bold text-primary">{{ stats.totalAppointments }}</h4>
              <p class="text-muted mb-0">T·ªïng l·ªãch h·∫πn</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <div class="text-warning mb-2">
                <i class="fas fa-clock fa-2x"></i>
              </div>
              <h4 class="fw-bold text-warning">{{ stats.pendingAppointments }}</h4>
              <p class="text-muted mb-0">Ch·ªù x√°c nh·∫≠n</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card border-0 shadow-sm">
            <div class="card-body text-center">
              <div class="text-success mb-2">
                <i class="fas fa-check-circle fa-2x"></i>
              </div>
              <h4 class="fw-bold text-success">{{ stats.completedAppointments }}</h4>
              <p class="text-muted mb-0">ƒê√£ ho√†n th√†nh</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="row">
        <!-- Left Column -->
        <div class="col-lg-8">
          <!-- Upcoming Appointments -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
              <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                  <i class="fas fa-calendar-check text-primary me-2"></i>
                  L·ªãch h·∫πn s·∫Øp t·ªõi
                </h5>
                <a routerLink="/my-appointments" class="btn btn-sm btn-outline-primary">
                  Xem t·∫•t c·∫£
                </a>
              </div>
            </div>
            <div class="card-body">
              <div *ngIf="loading" class="text-center py-3">
                <app-loading></app-loading>
              </div>
              
              <div *ngIf="!loading && upcomingAppointments.length === 0" class="text-center py-4 text-muted">
                <i class="fas fa-calendar-times fa-3x mb-3 opacity-50"></i>
                <p>Ch∆∞a c√≥ l·ªãch h·∫πn n√†o s·∫Øp t·ªõi</p>
                <a routerLink="/book-appointment" class="btn btn-primary">
                  <i class="fas fa-plus me-2"></i>ƒê·∫∑t l·ªãch ngay
                </a>
              </div>

              <div *ngIf="!loading && upcomingAppointments.length > 0">
                <div *ngFor="let appointment of upcomingAppointments" class="appointment-card mb-3">
                  <div class="row align-items-center">
                    <div class="col-md-3">
                      <div class="date-display text-center">
                        <div class="date-day">{{ formatDate(appointment.appointment_date) }}</div>
                        <div class="date-time text-primary fw-bold">{{ formatTime(appointment.appointment_time) }}</div>
                      </div>
                    </div>
                    <div class="col-md-6">
                      <h6 class="mb-1">{{ appointment.doctor?.user?.name }}</h6>
                      <p class="text-muted mb-1">{{ appointment.doctor?.specialty }}</p>
                      <small class="text-muted">{{ appointment.reason }}</small>
                    </div>
                    <div class="col-md-3 text-end">
                      <span [class]="getStatusBadgeClass(appointment.status)">
                        {{ getStatusText(appointment.status) }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Recent Appointments -->
          <div class="card shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0">
                <i class="fas fa-history text-success me-2"></i>
                L·ªãch s·ª≠ kh√°m g·∫ßn ƒë√¢y
              </h5>
            </div>
            <div class="card-body">
              <div *ngIf="recentAppointments.length === 0" class="text-center py-3 text-muted">
                <i class="fas fa-file-medical fa-2x mb-2 opacity-50"></i>
                <p>Ch∆∞a c√≥ l·ªãch s·ª≠ kh√°m n√†o</p>
              </div>

              <div *ngIf="recentAppointments.length > 0">
                <div *ngFor="let appointment of recentAppointments" class="border-bottom py-3">
                  <div class="row align-items-center">
                    <div class="col-md-8">
                      <h6 class="mb-1">{{ appointment.doctor?.user?.name }}</h6>
                      <p class="text-muted mb-1">{{ appointment.doctor?.specialty }}</p>
                      <small class="text-muted">{{ formatDate(appointment.appointment_date) }} - {{ formatTime(appointment.appointment_time) }}</small>
                    </div>
                    <div class="col-md-4 text-end">
                      <span class="badge bg-success">Ho√†n th√†nh</span>
                    </div>
                  </div>
                  <div *ngIf="appointment.notes" class="mt-2">
                    <small class="text-muted">
                      <i class="fas fa-sticky-note me-1"></i>
                      {{ appointment.notes }}
                    </small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Right Column -->
        <div class="col-lg-4">
          <!-- Profile Summary -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0">
                <i class="fas fa-user text-info me-2"></i>
                Th√¥ng tin c√° nh√¢n
              </h5>
            </div>
            <div class="card-body">
              <div *ngIf="patientProfile" class="text-center">
                <div class="avatar-circle mx-auto mb-3">
                  <i class="fas fa-user-circle fa-4x text-muted"></i>
                </div>
                <h6 class="fw-bold">{{ currentUser?.name }}</h6>
                <p class="text-muted mb-2">{{ currentUser?.email }}</p>
                <div *ngIf="patientProfile.date_of_birth" class="mb-2">
                  <small class="text-muted">
                    <i class="fas fa-birthday-cake me-1"></i>
                    {{ formatDate(patientProfile.date_of_birth) }}
                  </small>
                </div>
                <div *ngIf="patientProfile.phone" class="mb-3">
                  <small class="text-muted">
                    <i class="fas fa-phone me-1"></i>
                    {{ currentUser?.phone }}
                  </small>
                </div>
                <a routerLink="/patient-profile" class="btn btn-outline-primary btn-sm">
                  <i class="fas fa-edit me-1"></i>C·∫≠p nh·∫≠t th√¥ng tin
                </a>
              </div>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0">
                <i class="fas fa-bolt text-warning me-2"></i>
                Thao t√°c nhanh
              </h5>
            </div>
            <div class="card-body">
              <div class="d-grid gap-2">
                <a routerLink="/book-appointment" class="btn btn-primary">
                  <i class="fas fa-calendar-plus me-2"></i>
                  ƒê·∫∑t l·ªãch kh√°m m·ªõi
                </a>
                <a routerLink="/my-appointments" class="btn btn-outline-primary">
                  <i class="fas fa-list me-2"></i>
                  Xem t·∫•t c·∫£ l·ªãch h·∫πn
                </a>
                <a routerLink="/doctors" class="btn btn-outline-secondary">
                  <i class="fas fa-user-md me-2"></i>
                  T√¨m b√°c sƒ©
                </a>
              </div>
            </div>
          </div>

          <!-- Available Doctors -->
          <div class="card shadow-sm">
            <div class="card-header bg-white border-bottom">
              <h5 class="mb-0">
                <i class="fas fa-stethoscope text-success me-2"></i>
                B√°c sƒ© kh·∫£ d·ª•ng
              </h5>
            </div>
            <div class="card-body">
              <div *ngIf="availableDoctors.length === 0" class="text-center py-3 text-muted">
                <p>ƒêang t·∫£i danh s√°ch b√°c sƒ©...</p>
              </div>
              
              <div *ngIf="availableDoctors.length > 0">
                <div *ngFor="let doctor of availableDoctors" class="doctor-item mb-3 p-2 border rounded">
                  <div class="row align-items-center">
                    <div class="col-3">
                      <div class="doctor-avatar text-center">
                        <i class="fas fa-user-md fa-2x text-primary"></i>
                      </div>
                    </div>
                    <div class="col-9">
                      <h6 class="mb-1 small">{{ doctor.user?.name }}</h6>
                      <p class="mb-1 small text-muted">{{ doctor.specialty }}</p>
                      <small class="text-success">
                        <i class="fas fa-circle me-1"></i>Kh·∫£ d·ª•ng
                      </small>
                    </div>
                  </div>
                </div>
                <div class="text-center">
                  <a routerLink="/doctors" class="btn btn-sm btn-outline-primary">
                    Xem t·∫•t c·∫£ b√°c sƒ©
                  </a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
